
# 🌱 Java 메모리 구조 & Bean 스코프 완전 정리 (Step-by-Step)

---

## ✅ Step 1. 메모리 영역 이해: Stack, Heap, Method Area

| 메모리 영역 | 특징 | 저장되는 내용 | 수명 |
|-------------|------|----------------|------|
| 📦 스택 (Stack) | LIFO 구조 | 지역 변수, 매개변수 | 메서드 호출~종료 시까지 |
| 🧠 힙 (Heap) | 동적 메모리 | new로 생성된 객체 | 참조 없을 때 GC로 제거 |
| 🏛 메서드 영역 | 클래스 정보 저장 | static 변수, 클래스 정보 | 애플리케이션 종료 시까지 |

### 💡 예시로 보는 저장 위치

```java
int x = 10;                  // Stack (기본형 변수)
String s = new String("hi"); // s는 Stack, 객체는 Heap
static int count;            // Method Area
```

---

## ✅ Step 2. 변수 구분

| 구분 | 선언 위치 | 저장 위치 | 예시 |
|------|------------|------------|-------|
| 지역 변수 | 메서드 내부 | 스택 | `int x = 10;` |
| 인스턴스 변수 | 클래스 내부, static 없음 | 힙 | `String name;` |
| 클래스 변수 | static 있음 | 메서드 영역 | `static int count;` |

---

## ✅ Step 3. GC (Garbage Collector)

### 💥 언제 객체가 제거되나요?

- **더 이상 어떤 변수도 객체를 참조하지 않을 때**
- **강한 참조가 모두 끊긴 경우**

### 🔁 참조가 끊긴다는 뜻?

```java
String a = new String("hi");
a = null;  // 이제 GC 대상
```

### 📌 GC 관련 용어

| 용어 | 설명 | GC 대상 여부 |
|------|------|---------------|
| 강한 참조 | 일반적인 참조 방식 | ❌ |
| 약한 참조 (`WeakReference`) | GC가 수거할 수 있도록 약한 링크 | ✅ |

### ⚠️ `System.gc()`는 강제 아님!
> 요청만 보낼 뿐, JVM이 판단해서 수행

---

## ✅ Step 4. Spring의 Bean 스코프 이해

### 🎯 Bean이란?

> Spring이 관리하는 객체 (= 미리 생성해두고 필요할 때 꺼내줌)

### 📦 스코프 종류

| 스코프 | 생성 시점 | 수명 | GC 대상 가능성 | 설명 |
|--------|------------|------|----------------|------|
| `singleton` | 앱 시작 시 | 앱 종료까지 | 거의 ❌ | 기본값, 재사용 |
| `prototype` | 요청 시마다 | 참조 없을 때까지 | ✅ | 매번 새 객체 생성 |

### 💬 예시

```java
@Component
@Scope("singleton") // ← 기본값, 생략 가능
class A {}

@Component
@Scope("prototype")
class B {}
```

---

## ✅ Step 5. Singleton vs Prototype 실습 코드

```java
class SingletonBean {
    private static final SingletonBean instance = new SingletonBean();
    private SingletonBean() {
        System.out.println("🔵 SingletonBean 생성됨");
    }
    public static SingletonBean getInstance() {
        return instance;
    }
}

class PrototypeBean {
    public PrototypeBean() {
        System.out.println("🟠 PrototypeBean 생성됨");
    }
}

public class BeanScopeSimulation {
    public static void main(String[] args) {
        System.out.println("=== 싱글톤 Bean 요청 ===");
        SingletonBean s1 = SingletonBean.getInstance();
        SingletonBean s2 = SingletonBean.getInstance();
        System.out.println("같은 객체인가? " + (s1 == s2));

        System.out.println("\n=== 프로토타입 Bean 요청 ===");
        PrototypeBean p1 = new PrototypeBean();
        PrototypeBean p2 = new PrototypeBean();
        System.out.println("같은 객체인가? " + (p1 == p2));
    }
}
```

---

## ✅ Step 6. 핵심 요약

- 스택: 지역변수, 매개변수 저장
- 힙: new로 만든 객체 저장
- 메서드 영역: static, 클래스 정보 저장
- GC는 참조가 끊긴 객체만 수거
- Spring의 singleton은 한 번 생성 & 공유
- prototype은 요청할 때마다 새로 생성됨

---

